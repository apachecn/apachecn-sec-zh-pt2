# 6 对策

本章 涵盖

*   双重加密
*   空字符和空位
*   谐音
*   在图像或计算机文件中隐藏信息

回顾第 5.9 节，多字母密码可以通过两个步骤解决。首先，使用 Kasiski 方法或重合指数来确定周期或密钥长度。这将密文分成几个较小的文本，每个文本仅由密钥的一个字母加密。第二，这些单独的文本使用简单替代密码、频率和接触的标准方法被破译。

让我们把它转过来。密码学家如何防止多字母密码被这两个步骤破解？我们将研究一些对策。

## 6.1 双重加密

如果用周期为 P 的 多字母密码对一条消息进行加密，得到的中间文本用周期为 Q 的第二个多字母密码进行加密，结果相当于一个周期为 P 和 Q 的最小公倍数的多字母密码，记为 *lcm(P，Q)* 。例如，如果 P 是 10，Q 是 11，那么双重加密将具有 110 的周期，但是如果 P 是 10，Q 是 12，那么双重加密将具有 60 的周期，因为 60 是 10 和 12 的倍数。

双重加密中的每个字母是第一次和第二次加密中的两个字母的组合，如第 11.7.4 节所述。如果这些是移位的标准字母表，结果也是移位的标准字母表。如果这些是混合字母，结果很可能是更彻底混合的字母。

即使双重加密仍然是多字母加密，但它可以比单一多字母加密更强，因为周期更长，并且密钥的每个字符加密的字母会更少。这种双重加密被定为三级。

如果两个多字母加密是自动密钥、运行密钥或其中之一，则双重加密将是运行密钥加密。但是，该键不会是英文文本，因此不能使用 5.11 节的单词拖动技术。不过，这一节中的概率技术可以适用于两个运行密钥。

如果加密是用直接字母完成的，即使用 Belaso tableau，那么加密的顺序并不重要。用运行密钥 R 加密消息 M，然后用运行密钥 S 重新加密，这与用运行密钥 S 加密运行密钥 R 以获得新的复合运行密钥 C，然后用该复合运行密钥 C 加密消息 M 是一样的

通过用一个运行密钥加密另一个运行密钥，以这种方式得到的密钥不是随机的。他们有自己的特征字母频率和接触频率。有一些常见的序列，例如由加密的，或由加密的。所有这些都可以制成表格。如果一个长短语(如美利坚合众国或谈判策略)被拖过一个文本，您可以查找符合此分布的运行密钥的部分。这样双重运行密钥加密就可以用计算机解决了。

对于未混合的字母，两个自动密钥和/或运行密钥加密的组合被评定为 4。用混合好的键控字母，作文被评为 六种。

## 6.2 空字符

空号 是挫败敌人破译者的一种由来已久的方法。它们至少可以追溯到 15 世纪的 Argenti 家族。空字符是无意义的字符，被插入到消息中以迷惑敌人的密码分析者。它们通常与代码一起使用。对于多字母密码，它们会污染频率计数并破坏 Kasiski 或符合分析指数。

有几种方法可以使用空值。最直接的方法是在字母表中添加一个空字符。这通常表示为*星号。这个字符可以被分散到明文中。应该有节制地使用，以免突出和明显。大约 3%到 6%的空值是合理的。使用空值的一个有用方法是将它们插入到高频词中，以挫败 Kasiski 攻击。这应该随机进行。如果你每隔把*换成 T*HE，你就是在通过提供 4 个字符的重复来帮助艾米丽。最好是用一半的时间，四分之一的时间和四分之一的时间。使用*THE 或*没有好处，因为三元模型保持不变。*

加密表将会是 27 列宽，星号将会出现在密文中。你可能会认为这是正在使用空值的一种泄露，但是有一种被称为三分密码的密码，在 9.9 节中有描述，它使用了 27 个字符的字母表。艾米丽可能会认为你的多字母密码是三裂体(不要与约翰·温德姆 1951 年的小说*【三裂体之日】* 中的三条腿怪物植物混淆)。

以这种方式使用空值是相当脆弱的。它不会改变字母频率太多，也不会严重影响 Kasiski 或重合指数。该方法被评定为三级。

使用空值的第二种方法是在明文中插入一些特定的空字母序列。这些需要容易识别。我建议从少量中频率字母如 C、D 和 P 形成空序列。二元模型 CC、DD 和 PP 可用于表示字母 C、D 和 P，这些字母的其他 6 个二元模型组合将为空。这种方法也被评为 三种。

## 6.3 中断键

一种 更强的使用空值的方式是将空值插入密文中，以便它们打破重复周期。一个简单的方法是首先以正常的方式用多字母密码对信息进行加密。然后每当一些*触发* 事件，比如一些选择的字母或二元模型，出现在密文中，就在它后面插入一个空值。空值可以是任何字母，甚至是一个双字母。正是触发器的存在将它标记为空。

这种类型的空值插入可能相当复杂。您可以插入一个空值

*   密文中每个 W 后的 4 个字符，例如密文**npgwsovpidf**可能变成**NPGWSOV****T****KLEWPID****C****F**，

*   在密文中每过一秒钟 H，

*   在密文中每个 Q 后面的第一个 A 之后，

*   第一个 V 之后 1 个位置，然后下一个 B 之后 2 个位置，下一个 L 之后 3 个位置，然后重复 V，B，L，V，B，L，...,

*   在密文中的每个双字母后，或连续 3 个元音后，或按字母升序或降序连续 4 个字母后，

或者这些的某种组合。唯一的限制是你的想象力。只是不要把它弄得太复杂，以至于桑德拉和丽娃不能快速准确地加密和解密。如果桑德拉应该在每第 K 个和每第三个 M 后插入一个空值，而她漏掉了一个，或者在第四个 M 后插入了空值，那么丽娃可能无法破译该消息。

这种插入空值的方法对于标准字母被评定为 4 级，对于混合良好的字母被评定为 5 级，一如既往地假设混合字母是保密的。

还有其他几种方法可以中断密钥的周期性重复。一种方法是，每当明文中出现某种触发时，就重新启动密钥。这比前面的方法更安全，在前面的方法中，触发器在密文中，因为 Emily 可以看到密文，但看不到明文。另一方面，合法接收者更难。当触发器在密文中时，丽娃可以通过肉眼扫描并删除空值。当触发器是明文时，丽娃必须一次破译一个字符，同时注意触发器。

触发器可以类似于刚才提到的密文触发器，只是在明文中，而不是在密文中。触发器发生后采取的操作可以是

*   跳过密钥中特定数量的字符，或

*   重复键中特定数量的字符，或

*   从第一个字符重新开始按键，或

*   通过键切换方向、后退。

以下是使用密钥样本和触发字母 A 的 4 种密钥中断的示例:

![6-unnumb-1](img/6-unnumb-1.png)

对于直接字母，这种形式的按键中断被评定为五级，而对于混合字母，这种形式的按键中断被评定为六级。不要过于频繁地重启键，否则键的第一个字符会被过度使用，而键的最后一个字符会被忽略。

更强的密钥中断形式是使用两个不同长度的独立密钥。当密钥长度互为质数时，这种密码最强。当触发发生时，您从一个键切换到另一个键。当使用混合字母时，这种方法被评为六级。下面是一个使用第一个和第二个键以及触发器 A 的示例:

![6-unnumb-2](img/6-unnumb-2.png)

这个密码记录了最后一次使用密钥的字母。当您切换到另一个字母时，密钥的下一个字母继续加密。例如，明文 MA 用密钥字母 FI 加密，所以下一个密钥字母是 r。在用第二密钥中的密钥字母 SECO 加密 RYHA 之后，用密钥字母 rs 在第一密钥中继续加密。

这样，每个键中的所有字母被使用大约相同数量的 次数。

## 6.4 谐音替换

谐音 替换，在 4.2 节中介绍，为每个明文字母提供了几个替换，以使字母频率变平。最常见的方法是扩大密文字母表以提供额外的替代。因为经典的多字母密码采用固定的 26 个字母的字母表，至少对英语来说是这样，所以它们通常不使用谐音替换。

对于使用 8 位字节的计算机实现，谐音替换很容易完成。一个字节有 256 个可能的值。26 个大写字母、26 个小写字母、10 个数字和大约 32 个标点符号只使用了 256 个值中的 94 个。如果包括控制字符制表符、退格、换行和回车，就叫它 98。剩下 158 个字符可用于空值、二元和三元组以及键中断。

让我们来看看如何使用纸和笔，用一个普通的 26×26 混合画面来实现谐音替换。如果你保留一封信作为触发信，那封信出现的频率会很高，很容易被发现。两封触发信可能也是如此。我建议用 3 个触发信，每个频率在 4%以下。姑且称这个密码为 *Trig3* 。字母 BCDFGJKLMPQUVWXYZ 是合适的。假设您选择了 B、C 和 d。以这 3 个字母开头的二元模型有 78 个，即 3×26。您不会使用包含高频率字母 AEINORST 的二元模型，因为这将增加它们的频率，这与平坦化字母频率的目标背道而驰。剩下的 54 个二元模型可以用作空值、同音异义词和按键中断。这里有一个可能的集合:

![6-unnumb-3](img/6-unnumb-3.png)

这里 **-** 代表空字符，所以明文 BD、BL、CC 等等都是空字符。代码+1、+2 和+3 是按键中断，分别表示跳过 1、跳过 2 和跳过 3 个按键字母。同音字集包括 AN、ER、IN、ON、RE 和 TH 六个双字母以及单个字母。

保持平衡很重要。如果你过度使用这些替代品，那么字母 B、C 和 D 会出现频率过高，很容易被发现为触发因素。如果你过于吝啬地使用它们，那么它们就不会产生任何有用的影响。大约 10%是正确的，使用 B、C 和 D 二元模型的频率大致相等，因此大约各为 3%。记住，在这个密码中，你不能单独使用字母 B，C 和 D，你必须使用它们的替代品，DM，CD 和 CG。

如果使用得当，使用混合的键控字母，Trig3 密码被评为五级。

### 密码 5858

让 me 在进入二元模型替换之前再给出一个密码。我叫它*密码 5858*T10】。这是一个使用 5 位字符的计算机密码。五位给出了 32 个字符的字母表，足以容纳 26 个字母、3 个空字符和 3 个同音字。(1)使用混合字母表将明文写成 5 位字符序列。(2)插入空值和同音异义词，每种使用大约 3%，总共占明文的 18%。最好是随意地使用它们，而不是系统地使用它们。(3)如果需要，通过添加一个空字符和最多 4 个随机位来填充明文，使其长度为 8 的偶数倍。(4)填充的消息被视为 8 比特字节的串，并且执行混合良好的替换。例如，如果消息包含 80 个 5 位字符，那么这 400 位将按顺序作为 50 个 8 位字节。(5)消息再次被视为一个 5 位字符串。这些字符中的三个被选为密钥中断符+1、+2 和+3，如 Trig3 密码 中所示。(6)使用通用多字母密码和 5 位字符的混合 32×32 表格对消息进行加密。(7)然后将 5 位字符串重组为 8 位字节，并进行第二次 8 位替换。

概括地说，密码 5858 使用 4 个替换步骤，一个初始的 5 位替换，一个 8 位替换，一个带有密钥中断的 5 位通用多字母替换，以及一个最终的 8 位替换。这个暗号是 额定 七位。

## 6.5 二元和三元组替换

另一种 防止艾米莉使用字母和联系频率破解你密码的方法是对二元模型甚至三元模型进行替换。最简单的方法是用一个画面。对于二元模型，您可以使用 26×26 的 tableau，其中每个条目都是一个二元模型。这是这样一个场景的开始:

![6-unnumb-4](img/6-unnumb-4.png)

AA 的替代物是 **BL** ，AB 的替代物是 **TC** ，以此类推。对于三元模型替换，你可以使用一本有 26 个这样的表格的小册子，每个表格代表三元模型的第一个字母。

这种替代可以单独使用，也可以与其他方法结合使用，如多字母替代。单独使用，二元组替换为三级，三元组替换为四级。二元模型替换之后是具有机密良好混合字母的多字母替换被评级为 5，三元模型替换之后是具有机密良好混合字母的多字母替换被评级为 6。

## *6.6 隐藏图像中的信息

一个 有趣的想法，大约可以追溯到 1999 年，就是将信息隐藏在电脑上各种类型的数据文件里面。这是隐写术的现代版本(2.2 节)。让我们看一个这样的方法，在位图或 BMP 文件中隐藏消息。位图是逐像素存储的图像。最常见的位图格式用 3 个字节来表示每个像素，这 3 个字节指定了图像上的单个点中蓝色、绿色和红色的颜色深度。(这是 Microsoft 位图图像标准中与设备无关的顺序。如果你记不住顺序，请注意蓝色、绿色和红色是按字母顺序排列的。)例如，0，0，0 没有颜色，所以它是纯黑色，255，255，255 对于所有 3 种颜色都具有最大深度，所以它是白色，而 255，0，0 将是纯蓝色。

像素一般用十六进制表示，所以纯蓝会是 FF0000。在一些计算机语言中，这被写成$FF0000 或 X'FF0000 '甚至 0xFF0000，因为十进制的 255 是十六进制的 FF。在某些语言中，颜色成分的顺序是相反的。例如，在 HTML 中，纯蓝将是#0000FF。

整个图像可能包含数百或数千行像素，每行包含数百或数千个像素。位图包含 3000 行，每行 4000 像素，这并不罕见。这样的图像将具有 12，000，000 个像素，并且将需要 36，000，000 字节的存储，加上 54 字节的标题信息。这就是为什么拥有许多高分辨率图像会如此迅速地填满一台计算机的内存。

诀窍是在像素的每个分量中使用低阶位来携带一位信息。这可能不会被发现，因为 FF0000 和 FE0000 甚至 FE0101 之间的差异肉眼几乎察觉不到。在大图像的单个像素中，它在视觉上是察觉不到的。此外，一半的位不会改变值。在图像中隐藏信息时，包含图像的文件必须准确传输。图像不得被放大、缩小、裁剪、旋转、倾斜、压缩或转换成另一种图像格式。

信息可以用任何方法加密。然而，如果 Emily 怀疑你用这种方式隐藏消息，那么它不会增加任何额外的安全性。你将为每一位信息传输 8 位数据付出代价，却没有相应的收益。如果你简单地从每个像素中依次取出每个低位比特 ，那么无论你选择哪种加密方法，等级都是一样的。

从该方案中获得额外安全性的一种方式是不使用所有的位，而是以某种循环顺序从每个像素中选择某些位。为此，使用一串八进制数字(见第 3.1 节中的表格)，如 1、3、7、4、6，作为选择消息位的密钥。这可以称之为*选择键* 。它有 5 个八进制数字，因此有 15 个选择位。从图像的第一个像素和选择键的第一个数字开始。如果该数字的第一位是 1，则将消息的一位放入像素的蓝色分量的低位，否则将低位随机设置为 0 或 1。如果第二个关键位是 1，对绿色分量做同样的操作，如果第三个关键位是 1，对红色分量做同样的操作。然后对第二个像素和选择键的第二个数字重复此操作。诸如此类。

有人可能认为当密钥位为 0 时，最好保持图像的相应位不变。这将减少图像失真，使艾米丽更难发现它包含隐藏的信息。没错，但是如果 Emily 怀疑你在使用这种方法，那么就有可能确定选择键。

假设是这样。Emily 截获了你包含位图图像的消息。进一步假设 Emily 已经在互联网上进行了图像搜索，并且找到了原始图像。Emily 可以逐个像素和逐个颜色分量地匹配两幅图像。这使得艾米丽能够绘制出两个版本图像的不同之处。在低位匹配的地方，Emily 可以在地图上标记 X，在不匹配的地方，Emily 可以标记|。然后，Emily 可以尝试选择键的每个可能长度。当选择了正确的长度 L，并且标记以 L 个像素的间隔排列时，选择位为 0 的每一列将包含所有的 X，而选择位为 1 的每一列将包含一半的 X 和一半的|。例如，再次使用选择键 1，3，7，4，6，您可能会看到

![6-unnumb-5](img/6-unnumb-5.png)

对于包含|的每一列，选择键的相应位必须是 1。选择键的所有其他位可能是 0。差异图中的行数越多，概率就越高。

因此，只要选择位为 0，就应该随机设置颜色分量的低位位。这种隐藏消息的方法使用循环选择密钥，如果基础密码的等级是 1 到 4，则加 2，如果等级是 5 到 8，则加 1。

选择密钥也可以通过第 4.5 节中的链式数字伪随机发生器使用 7、9 或 10 位的合格种子生成。使用生成的数字 0 到 7 作为选择数字。如果生成的数字是 8 或 9，丢弃它并生成下一个数字。伪随机数在统计上是否随机并不重要。本质属性是生成的数字序列比消息长，以比特为单位，因此 Emily 无法匹配具有相同选择密钥的密文部分。

使用链式数字选择键，这种隐藏消息的方法如果基础密码的等级是 1 到 4，则加 3，如果等级是 5 到 7，则加 2，如果等级是 8，则加 1。 ******

## 6.7 添加空位

这种 将消息的比特与空比特混合的想法也可以在不将消息嵌入图像或其他文件的情况下完成，并且可以手动完成。首先，用简单的替换或你选择的任何方法加密信息。用二进制写这个初步的密文，比如说 5 位二进制。简单的替换和转换成二进制可以一步完成。你可以用 5 位数字代替字母表中的 26 个字母，以某种混合顺序排列，就像这样:

![6-unnumb-6](img/6-unnumb-6.png)

注意，除了字母表中的 26 个字母外，还有 6 个十进制数字。数字 0、1、2 和 5 被省略，以防止手写时与字母 O、I、Z 和 S 混淆。这为您提供了将 5 位数字转换回传输符号所需的 32 个字符。

现在消息是以位串的形式，可以添加空位。选择键用于指定空位插入的位置。选择键具有 m1，n1，m2，n2，m3，n3，...，这意味着取消息的 m 个 <sub class="fm-subscript">1 个</sub>比特并插入 n1 个空比特，取消息的 m2 个比特并增加 n2 个空比特，取消息的另外 m3 个比特并增加 n3 个空比特，等等。这是一个使用选择键 2，1，3，1，4，2，3，2 的例子。

![6-unnumb-7](img/6-unnumb-7.png)

使用这种方案，消息被加密为**Q9JIF PGUFF**。附加四个空比特(阴影比特)以完成最后一组 5 比特。这叫做*填充* 或*零填充* 。

选择键也可以以二进制形式给出，比如 1101110111100111100。密钥中的每个 1 位表示取下一个消息位，而每个 0 位表示插入一个空位。

当使用两种不同的字母将字母转换成位和将位转换回字母时，这种方案更有效。通过使用可变长度替代物，如 10.4 节中描述的霍夫曼码，强度也得到提高。为此，代码的长度不必与字母的频率相对应，但它们仍必须具有前缀属性，这样丽娃才能破译信息。

你可以通过两种方式避免为第二次替换添加额外的字符，第二次替换从位回到字母。(1)您可以以 4 位为一组，仅使用字母表中的 16 个字母，或者使用 16 个十六进制数字，或者(2)您可以使用具有 6 个 4 位代码组和 20 个 5 位代码组的可变长度代码。同样，这些代码组必须具有 prefix 属性。这里有一个例子:

![6-unnumb-8](img/6-unnumb-8.png)

注意，我用 4 位替代了 6 个最高频率的字母。这将使这 6 个字母在密文中的出现频率是其他 20 个字母的两倍。这可能会让粗心的对手认为这是一种完全不同类型的密码。

添加空位适用于多种类型的加密。由于空位与其他任何位都无法区分，因此添加空位比添加空字符更有效。它可以将密码的等级提高三级。

让我们来看一个具体的例子。称之为*密码 Null5* 。如前所述，有 3 个步骤，从字母转换为比特，添加空比特，然后从比特转换回字母。使用从字母到 5 位组的谐音替换将字母转换为位。为字母 E、T、A、O、I、n 中的每一个都提供了两个替代。使用选择键插入空位，如第 6.6 节所示。与上表一样，使用 4 位/5 位替换将位转换回字母。

密码 Null5 被评为 六种。

## 6.8 合并多条消息

二进制形式的密钥也可以用作合并密钥来合并两条消息。也就是说，两个消息的比特被交织以形成单个消息。基数 3 或基数 4 中的合并键可用于合并 3 或 4 条消息。基数为 4 的合并密钥同样可以合并 3 个消息加上空比特。

合并多条消息的两个好处是，你不会像使用空比特那样增加额外的长度，而且你可以使用更简单、更快速的加密。如果用一个长的 merge 键交错 4 条消息，并对每条消息使用不同的简单替换，那么仅这一项就可以得到 5 分。如果您对合并的邮件执行额外的简单替换，等级将增加到 8。

用于合并消息的密钥可以采取两种形式，比特计数形式或选择形式。在比特计数形式中，消息被轮流接收。密钥的每个数字指定从每个连续消息中取出多少位。在选择表中，消息可以按任何顺序读取，但每次只读取一位。密钥的每个数字指定从哪个消息中取出下一位。这些示例显示了消息**01010111101000110101011**和**111010100110111100110**如何通过使用密钥 123123 的位计数方法和使用密钥 12122112 的选择方法进行合并。

![6-unnumb-9](img/6-unnumb-9.png)

当消息长度不同时，合并多条消息可能会很麻烦。除了最长的消息之外，所有消息都需要有一个消息结束标记。处理不匹配长度的另一种方法是平衡合并。首先，将所有消息首尾相连，用保留字符或字符序列隔开。然后简单的把这一长串分成等份。例如，如果消息的长度为 50、60、70 和 80 个字符，则总长度为 260 个字符，加上 3 个分隔符，总共为 263 个字符。你可以把它分成 4 串，分别是 66，66，66 和 65 个字符。如果使用 8 位字节，可以将 263×8 = 2104 位分成 4 个 526 位的部分。没有必要在偶数字节边界上分割位串，但是您应该选择从每个串中取相同数量位的密钥。

顺便说一下，消息的数量和链的数量是独立的。可以有一条或多条信息，也可以有 2 条以上任意数量的链。例如，一条消息可以分成 3 股，3 条消息可以分成 2 股。

平衡是解决问题的一半。另一半在合并过程接近尾声时到来。最终，您将合并其中一个字符串的所有位，而其他字符串还有位剩余。如果合并键指定了没有剩余位的字符串中的另一个位，就跳到下一个位选择。

让我们把所有这些都拉到一个密码里，可以叫做*合并 8* 。Merge8 密码对一条或多条首尾相连的消息进行运算。在 base-26 版本中，使用 4 位/5 位代码将 26 个字母转换为二进制，就像 6.7 节中的 4 位/5 位替换一样。消息分隔符可以是字母序列，如 XXX 或 END。在 base-256 版本中，混合良好的键控简单替换被应用于 ASCII 代码。产生的位串被分成 8 个等长的位串。使用 32 个八进制数字的密钥来合并 8 股。8 个八进制值每一个在密钥中出现 4 次，所以有 32 个！/(4!) <sup class="fm-superscript">8</sup> = 2.39×10 <sup class="fm-superscript">24</sup> 可能的合并键。对结果字符串执行第二次简单的替换。8 位替换用于 base-26 和 base-256 版本。Merge8 是额定的 六种。

## 6.9 在文件中嵌入消息

当 一条消息被隐藏在一个图片文件中时，该图片的每一位消息至少有 7 位。这是非常低效的。如果你不想让它看起来像别的东西，你可以在一个文件中隐藏更多的信息位。这是密文，所以让它看起来像密文。有许多方法可以将明文信息隐藏在文件中。我将简单地列出一些选择。如在 6.6 节中，对于文件的每个字节，在 8 位中隐藏了一定数量的明文位。

*   每次取固定数量的明文比特或可变数量的明文比特。

*   比特被放置在每个字节内的固定比特位置或可变比特位置。

*   这些位被按顺序放置或重新排列。

*   明文比特被原样插入，或者被轻度加密，例如通过简单的替换。

*   密文比特保持原样，或者轻度加密，例如通过简单的替换。

比特的数量、比特的位置和比特的顺序可以由周期密钥或一些随机序列来控制。根据所选择的选项，这一类的密码可以从 1 分到 10 分。

下面是这种密码的一个例子。(1)对消息执行混合良好的键控简单替换。(2)使用具有大内部状态的伪随机数发生器，在每个字节中选择 2 到 6 个比特位置。将消息的下 2 至 6 位按顺序放入这些 2 至 6 位位置。将剩余的位位置设置为随机值。(3)执行第二次混合良好的键控简单替换。

这种叫做 *EmbedBits* 的方法，极其快速简单。缺点是密文的长度大约是明文的两倍。嵌入比特被评定为八。要将评级提高到 10，请用一个二元模型替换简单替换，例如两个 正方形。